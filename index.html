<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monthly Budget Tracker</title>

  <link rel="stylesheet" href="./styles.css" />
  <link rel="icon" href="data:,">


  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- jsPDF (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
  <!-- ‚úÖ Loading Popup -->
  <div id="loadingOverlay" class="overlay hidden" aria-live="polite" aria-busy="true">
    <div class="overlayCard">
      <div class="spinner" aria-hidden="true"></div>
      <div class="overlayText">
        <div class="overlayTitle" id="loadingTitle">Loading‚Ä¶</div>
        <div class="overlaySub" id="loadingSub">Please wait</div>
      </div>
    </div>
  </div>

  <!-- TOP BAR -->
  <header class="topbar">
    <!-- LOADING OVERLAY -->
<div id="loadingOverlay" class="hidden" style="
  position:fixed; inset:0; z-index:9999;
  background: rgba(15,23,42,0.45);
  display:flex; align-items:center; justify-content:center;
  padding: 18px;
">
  <div class="card" style="max-width:420px; width:100%; text-align:center;">
    <div style="font-weight:950; font-size:16px;" id="loadingTitle">Loading‚Ä¶</div>
    <div class="muted" style="margin-top:6px;" id="loadingSub">Please wait</div>
    <div style="margin-top:12px; display:flex; justify-content:center;">
      <div style="
        width:26px; height:26px; border-radius:999px;
        border: 3px solid rgba(27,42,107,0.25);
        border-top-color: rgba(27,42,107,0.95);
        animation: spin 0.9s linear infinite;
      "></div>
    </div>
  </div>
</div>

<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">Monthly Budget Tracker</div>
        <div class="subtitle">Simple ‚Ä¢ Royal ‚Ä¢ Real-life money planning</div>
      </div>
    </div>

    <div class="topbar-actions">
      <div class="chip hidden" id="userChip"></div>
      <button class="btn ghost hidden" id="btnSignOut" type="button">Sign out</button>
    </div>
  </header>

  <!-- AUTH -->
  <main class="wrap">
    <section class="card auth-card" id="authCard">
      <h2>Sign in</h2>
      <p class="muted">Use your email + password. (Firebase Authentication)</p>

      <div class="grid2">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@email.com" autocomplete="email" />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </div>
      </div>

      <div class="row">
        <button class="btn primary" id="btnLogin" type="button">Login</button>
        <button class="btn" id="btnRegister" type="button">Create account</button>
        <div class="muted" id="authStatus">Not signed in</div>
      </div>
    </section>

    <!-- APP -->
    <section class="card hidden" id="appCard">
      <!-- CONTROLS -->
      <div class="controls">
        <div class="field">
          <label for="monthPicker">Pick a month</label>
          <input id="monthPicker" type="month" />
        </div>

        <div class="field">
          <label for="cutoffDay">Payday cutoff day</label>
          <input id="cutoffDay" type="number" min="1" max="28" value="25" />
          <div class="hint">If a date is on/after this day, it counts for next month.</div>
        </div>

        <div class="controls-actions">
          <button class="btn" id="btnSeedDemo" type="button">Add sample setup</button>
          <button class="btn primary" id="btnExportPdf" type="button">Download report (PDF)</button>
        </div>
      </div>

      <!-- TABS -->
      <div class="tabs">
        <button class="tab active" data-tab="overview" type="button">Overview</button>
        <button class="tab" data-tab="thismonth" type="button">This month</button>
        <button class="tab" data-tab="budgetplan" type="button">Budget plan</button>
        <button class="tab" data-tab="spending" type="button">Spending</button>
        <button class="tab" data-tab="lifestuff" type="button">Life stuff</button>
        <button class="tab" data-tab="more" type="button">More</button>
      </div>

      <!-- OVERVIEW -->
      <div class="tabpane active" id="tab-overview">
        <div class="kpis">
          <div class="kpi">
            <div class="kpi-label">Planned result</div>
            <div class="kpi-value" id="kpiPlannedNet">RM 0.00</div>
            <div class="kpi-sub">Planned income ‚àí planned spending</div>
          </div>

          <div class="kpi">
            <div class="kpi-label">Actual result</div>
            <div class="kpi-value" id="kpiActualNet">RM 0.00</div>
            <div class="kpi-sub">Actual income ‚àí actual spending</div>
          </div>

          <div class="kpi">
            <div class="kpi-label">Actual income</div>
            <div class="kpi-value" id="kpiActualIncome">RM 0.00</div>
            <div class="kpi-sub">All income this month</div>
          </div>

          <div class="kpi warn">
            <div class="kpi-label">Unpaid bills</div>
            <div class="kpi-value" id="kpiUnpaidBills">RM 0.00</div>
            <div class="kpi-sub" id="kpiUnpaidBillsHint">No data</div>
          </div>
        </div>

        <div class="gridOverviewExtras">
          <section class="card inner">
            <div class="cardTitle">Overtime calculator</div>
            <p class="muted small">Enter hours for each OT rate. We calculate OT pay based on your base hourly rate.</p>

            <div class="grid2">
              <div class="field">
                <label for="otBaseRate">Base hourly rate (RM)</label>
                <input id="otBaseRate" type="number" step="0.01" placeholder="e.g. 12.50" />
              </div>

              <div class="field">
                <label for="otDate">OT date (optional)</label>
                <input id="otDate" type="date" />
              </div>

              <div class="field">
                <label for="otH15">Hours @ 1.5x</label>
                <input id="otH15" type="number" step="0.01" placeholder="0" />
              </div>

              <div class="field">
                <label for="otH20">Hours @ 2.0x</label>
                <input id="otH20" type="number" step="0.01" placeholder="0" />
              </div>

              <div class="field">
                <label for="otH30">Hours @ 3.0x</label>
                <input id="otH30" type="number" step="0.01" placeholder="0" />
              </div>

              <div class="field">
                <label for="otCategory">Save as category</label>
                <input id="otCategory" type="text" placeholder="Overtime" value="Overtime" />
              </div>
            </div>

            <div class="otResult">
              <div class="otLine">
                <div class="muted">Estimated OT pay</div>
                <div class="moneyBig" id="otTotalPay">RM 0.00</div>
              </div>

              <div class="otBreakdown muted small" id="otBreakdown">Enter hours to calculate.</div>

              <div class="row">
                <button class="btn primary" id="btnAddOtIncome" type="button">Add OT as income (this month)</button>
                <span class="muted small" id="otStatus"></span>
              </div>
            </div>
          </section>

          <section class="card inner">
            <div class="cardTitle">Savings & investment suggestion</div>
            <p class="muted small">Based on your actual leftover (income ‚àí spending).</p>

            <div class="grid2 suggestInputs">
              <div class="field">
                <label for="savePct">Save %</label>
                <input id="savePct" type="number" step="1" min="0" max="100" />
              </div>
              <div class="field">
                <label for="investPct">Invest %</label>
                <input id="investPct" type="number" step="1" min="0" max="100" />
              </div>
            </div>

            <div class="suggestBox">
              <div class="suggestRow">
                <div class="suggestLabel">Leftover this month</div>
                <div class="suggestValue" id="leftoverValue">RM 0.00</div>
              </div>

              <div class="suggestRow">
                <div class="suggestLabel">Suggested savings</div>
                <div class="suggestValue" id="suggestSave">RM 0.00</div>
              </div>

              <div class="suggestRow">
                <div class="suggestLabel">Suggested investment</div>
                <div class="suggestValue" id="suggestInvest">RM 0.00</div>
              </div>

              <div class="note" id="suggestNote">
                Tip: If leftover is negative, focus on reducing spending first.
              </div>
            </div>
          </section>
        </div>

        <div class="gridCharts">
          <div class="card inner">
            <div class="cardTitle">Planned vs actual</div>
            <canvas id="barPlannedActual" height="140"></canvas>
          </div>

          <div class="card inner">
            <div class="cardTitle">Spending by group</div>
            <canvas id="pieExpenses" height="140"></canvas>
          </div>

          <div class="card inner full">
            <div class="cardTitle">Last 12 months (net)</div>
            <canvas id="lineNet" height="130"></canvas>
          </div>
        </div>
      </div>

      <!-- THIS MONTH -->
      <div class="tabpane" id="tab-thismonth">
        <div class="row between">
          <div>
            <h2 class="sectionTitle">This month summary</h2>
            <p class="muted">Planned vs actual by group/category (easy view).</p>
          </div>
          <button class="btn primary" id="btnExportPdf2" type="button">Download report (PDF)</button>
        </div>

        <div class="filters">
          <div class="field">
            <label for="monthlyGroupFilter">Group</label>
            <select id="monthlyGroupFilter"></select>
          </div>

          <div class="field">
            <label for="monthlySearch">Search</label>
            <input id="monthlySearch" type="text" placeholder="Type to search..." />
          </div>

          <div class="hint" id="monthlyTotalsHint"></div>
        </div>

        <div class="tableWrap">
          <table class="table" id="monthlyTable">
            <thead>
              <tr>
                <th>Group</th>
                <th>Category</th>
                <th>Type</th>
                <th class="right">Planned</th>
                <th class="right">Actual</th>
                <th class="right">Difference</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- BUDGET PLAN -->
      <div class="tabpane" id="tab-budgetplan">
        <div class="row between">
          <div>
            <h2 class="sectionTitle">Budget plan</h2>
            <p class="muted">Set your plan for the month (income + spending).</p>
          </div>
          <div class="row">
            <button class="btn" id="btnAddPlanRow" type="button">Add row</button>
            <button class="btn primary" id="btnSavePlan" type="button">Save plan</button>
          </div>
        </div>

        <div class="hint" id="planSavedHint"></div>

        <datalist id="dlGroups"></datalist>
        <datalist id="dlCategories"></datalist>

        <div class="tableWrap">
          <table class="table" id="planTable">
            <thead>
              <tr>
                <th>Group</th>
                <th>Category</th>
                <th>Type</th>
                <th class="right">Planned (RM)</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- SPENDING -->
      <div class="tabpane" id="tab-spending">
        <div class="row between">
          <div>
            <h2 class="sectionTitle">Spending / Income</h2>
            <p class="muted">Add your real spending and income here.</p>
          </div>
          <button class="btn primary" id="btnAddTx" type="button">Add item</button>
        </div>

        <div class="tableWrap">
          <table class="table" id="txTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Group</th>
                <th>Category</th>
                <th class="right">Amount (RM)</th>
                <th>Month</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <p class="muted small">
          Tip: The ‚ÄúMonth‚Äù uses your cutoff day so late-month payments can count into next month.
        </p>
      </div>

      <!-- LIFE STUFF -->
      <div class="tabpane" id="tab-lifestuff">
        <div class="gridLife">

          <!-- BILLS -->
          <section class="card inner">
            <h2 class="sectionTitle">Bills to pay</h2>
            <p class="muted">Monthly checklist (rent, utilities, phone...).</p>

            <div class="grid2">
              <div class="field">
                <label for="billName">Bill name</label>
                <input id="billName" type="text" placeholder="e.g. Rent / Internet" />
              </div>
              <div class="field">
                <label for="billGroup">Group</label>
                <input id="billGroup" type="text" list="dlGroups" placeholder="e.g. Needs" />
              </div>
              <div class="field">
                <label for="billAmount">Amount (RM)</label>
                <input id="billAmount" type="number" step="0.01" placeholder="0.00" />
              </div>
              <div class="field">
                <label for="billDueDay">Due day (1‚Äì28)</label>
                <input id="billDueDay" type="number" min="1" max="28" value="1" />
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddBill" type="button">Add bill</button>
              <button class="btn" id="btnApplyBills" type="button">Apply to this month</button>
              <button class="btn" id="btnRefreshBills" type="button">Refresh</button>
              <span class="muted" id="billStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="billsTable">
                <thead>
                  <tr>
                    <th>Paid?</th>
                    <th>Paid date</th>
                    <th>Name</th>
                    <th class="right">Amount</th>
                    <th>Due day</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="note">
              <b>Tip:</b> ‚ÄúApply to this month‚Äù safely creates missing bill items (you can press many times).
            </div>
          </section>

          <!-- DEBTS -->
          <section class="card inner">
            <h2 class="sectionTitle">Debts & loans</h2>
            <p class="muted">House loan, car/motor loan, credit card (auto interest + principal).</p>

            <div class="grid2">
              <div class="field">
                <label for="debtName">Name</label>
                <input id="debtName" type="text" placeholder="e.g. House Loan / Car Loan / Maybank Card" />
              </div>

              <div class="field">
                <label for="debtType">Type</label>
                <select id="debtType">
                  <option value="home_loan">Home loan</option>
                  <option value="car_loan">Car / motor loan</option>
                  <option value="credit_card">Credit card</option>
                  <option value="personal_loan">Personal loan</option>
                </select>
              </div>

              <div class="field">
                <label for="debtApr">APR %</label>
                <input id="debtApr" type="number" step="0.01" placeholder="e.g. 4.2" />
              </div>

              <div class="field">
                <label for="debtBalance">Current balance (RM)</label>
                <input id="debtBalance" type="number" step="0.01" placeholder="0.00" />
              </div>

              <div class="field">
                <label for="debtMonthlyPay">Monthly payment (RM)</label>
                <input id="debtMonthlyPay" type="number" step="0.01" placeholder="0.00" />
              </div>

              <div class="field">
                <label for="debtDueDay">Due day (1‚Äì28)</label>
                <input id="debtDueDay" type="number" min="1" max="28" value="1" />
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddDebt" type="button">Add debt</button>
              <button class="btn" id="btnRefreshDebts" type="button">Refresh</button>
              <span class="muted" id="debtStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="debtsTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th class="right">Balance</th>
                    <th class="right">Monthly</th>
                    <th>This month</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="note">
              <b>Tip:</b> ‚ÄúPay this month‚Äù records payment + updates your balance using interest + principal.
            </div>
          </section>

          <!-- FUNDS -->
          <section class="card inner">
            <h2 class="sectionTitle">Saving pockets (Sinking funds)</h2>
            <p class="muted">For big things: car repair, yearly insurance, holiday, etc.</p>

            <div class="grid2">
              <div class="field">
                <label for="fundName">Fund name</label>
                <input id="fundName" type="text" placeholder="e.g. Car maintenance / Holiday / Insurance" />
              </div>
              <div class="field">
                <label for="fundGoal">Goal (RM)</label>
                <input id="fundGoal" type="number" step="0.01" placeholder="0.00" />
              </div>
              <div class="field">
                <label for="fundTarget">Target month</label>
                <input id="fundTarget" type="month" />
              </div>
              <div class="field">
                <label for="fundSaved">Current saved (RM)</label>
                <input id="fundSaved" type="number" step="0.01" placeholder="0.00" />
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddFund" type="button">Add fund</button>
              <button class="btn" id="btnRefreshFunds" type="button">Refresh</button>
              <span class="muted" id="fundStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="fundsTable">
                <thead>
                  <tr>
                    <th>Fund</th>
                    <th class="right">Saved</th>
                    <th class="right">Goal</th>
                    <th class="right">Monthly needed</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <!-- VEHICLES -->
          <section class="card inner">
            <h2 class="sectionTitle">Vehicle maintenance</h2>
            <p class="muted">Track service + next service due (km / months).</p>

            <div class="grid2">
              <div class="field">
                <label for="vehName">Vehicle name</label>
                <input id="vehName" type="text" placeholder="e.g. Myvi / Vios / Yamaha" />
              </div>
              <div class="field">
                <label for="vehPlate">Plate (optional)</label>
                <input id="vehPlate" type="text" placeholder="ABC1234" />
              </div>
              <div class="field">
                <label for="vehMileage">Current mileage (km)</label>
                <input id="vehMileage" type="number" step="1" placeholder="0" />
              </div>
              <div class="field">
                <label for="vehIntervalKm">Service interval (km)</label>
                <input id="vehIntervalKm" type="number" step="1" value="10000" />
              </div>
              <div class="field">
                <label for="vehIntervalMonths">Service interval (months)</label>
                <input id="vehIntervalMonths" type="number" step="1" value="6" />
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddVehicle" type="button">Add vehicle</button>
              <button class="btn" id="btnRefreshVehicles" type="button">Refresh</button>
              <span class="muted" id="vehStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="vehiclesTable">
                <thead>
                  <tr>
                    <th>Vehicle</th>
                    <th>Next due</th>
                    <th>Service log</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>

      <!-- MORE -->
      <div class="tabpane" id="tab-more">
        <div class="gridMore">
          <section class="card inner">
            <h2 class="sectionTitle">Categories</h2>
            <p class="muted">Manage your groups and categories (simple words, not developer style).</p>

            <div class="grid2">
              <div class="field">
                <label for="catGroup">Group</label>
                <input id="catGroup" type="text" placeholder="e.g. Needs / Wants / Income" />
              </div>
              <div class="field">
                <label for="catName">Category</label>
                <input id="catName" type="text" placeholder="e.g. Groceries" />
              </div>
              <div class="field">
                <label for="catType">Type</label>
                <select id="catType">
                  <option value="expense">spending</option>
                  <option value="income">income</option>
                </select>
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddCategory" type="button">Add category</button>
              <button class="btn" id="btnRefreshCategories" type="button">Refresh</button>
              <span class="muted" id="catStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="catsTable">
                <thead>
                  <tr>
                    <th>Group</th>
                    <th>Category</th>
                    <th>Type</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <section class="card inner">
            <h2 class="sectionTitle">Recurring items</h2>
            <p class="muted">Auto-create items each month (salary, subscriptions, etc.).</p>

            <div class="grid2">
              <div class="field">
                <label for="recType">Type</label>
                <select id="recType">
                  <option value="expense">spending</option>
                  <option value="income">income</option>
                </select>
              </div>
              <div class="field">
                <label for="recGroup">Group</label>
                <input id="recGroup" type="text" list="dlGroups" placeholder="e.g. Income / Needs" />
              </div>
              <div class="field">
                <label for="recCategory">Category</label>
                <input id="recCategory" type="text" list="dlCategories" placeholder="e.g. Salary / Netflix" />
              </div>
              <div class="field">
                <label for="recAmount">Amount (RM)</label>
                <input id="recAmount" type="number" step="0.01" placeholder="0.00" />
              </div>
              <div class="field">
                <label for="recDay">Day of month (1‚Äì28)</label>
                <input id="recDay" type="number" min="1" max="28" value="1" />
              </div>
              <div class="field">
                <label for="recStart">Start month</label>
                <input id="recStart" type="month" />
              </div>
              <div class="field">
                <label for="recEnd">End month (optional)</label>
                <input id="recEnd" type="month" />
              </div>
              <div class="field">
                <label for="recActive">Active?</label>
                <select id="recActive">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>
              </div>
            </div>

            <div class="row">
              <button class="btn primary" id="btnAddRecurring" type="button">Add recurring</button>
              <button class="btn" id="btnApplyRecurring" type="button">Apply to this month</button>
              <button class="btn" id="btnRefreshRecurring" type="button">Refresh</button>
              <span class="muted" id="recStatus"></span>
            </div>

            <div class="tableWrap">
              <table class="table" id="recTable">
                <thead>
                  <tr>
                    <th>Active</th>
                    <th>Type</th>
                    <th>Group</th>
                    <th>Category</th>
                    <th class="right">Amount</th>
                    <th>Day</th>
                    <th>Range</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>

    </section>

    <footer class="footer">
      ùï†ùïßùïñùï£ùï§ùïñùïñùï£ ‚úß Admkhzmi
    </footer>
  </main>

  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
